var setSpwSortable;jQuery(document).ready(function(a){setSpwSortable=function(){a(".selected-posts").sortable({stop:function(){c=[],a(this).find(".selected-post").each(function(){c.push(a(this).data("post-id"))}),a(this).closest(".spw-form").find(".post-list").val(JSON.stringify(c)),b(a(this))}})};var b=function(a){a.closest(".widget-content").find("input.title").change()},c=[],d=a(".widgets-holder-wrap, #accordion-panel-widgets"),e=function(c,d){var e=[],f=c.closest(".spw-form"),g=f.find(".spw-no-selected");c.find(".post-list"),c.val()&&(e=JSON.parse(c.val())),e&&!a.isArray(e)&&(e=[]),e.push(d),g.hide(),c.val(JSON.stringify(e)),b(c)},f=function(c){var d=[],e=c.find(".spw-no-selected");c.find(".selected-post:visible").each(function(){d.push(a(this).data("post-id"))}),d.length<=0&&e.show(),c.find(".post-list").val(JSON.stringify(d)),b(c)},g=function(){d.on("click",".spw-plus",function(){var b=a(this).closest(".spw-form"),c=a(this).closest(".search-result"),d=b.find(".post-list"),f=c.data("post-id"),g=b.find(".selected-posts");e(d,f),c.addClass("selected-post").removeClass("search-result"),c.find(".spw-plus").html("-").addClass("spw-minus").removeClass("spw-plus"),g.append(c)}),d.on("click",".spw-minus",function(){var b=a(this).closest(".spw-form"),c=a(this).closest(".selected-post");c.fadeOut(function(){f(b),a(this).remove()})}),a(".spw-search").closest(".widget-content").each(function(){a(this).unbind("keydown")}),d.on("keydown",".spw-search",function(b){if(a(this).removeClass("warning"),13===b.which){b.preventDefault();var c=a(this).closest(".spw-form");c.find(".spw-search-button").click()}}),d.on("click",".spw-search-button",function(){var b=a(this).closest(".spw-form"),c=b.find(".loading"),d=b.find(".spw-search").val(),e=b.find(".search-results"),f=b.find(".security"),g=f.val(),h=b.closest(".widget-content").siblings(".widget-id").val();if(e.html(""),!d)return void b.find(".spw-search").addClass("warning");var i=b.find(".post-list");c.show();var j={action:"spw_search",query:d,alreadySelected:i.val(),widget_id:h,security:g};a.post(ajaxurl,j,function(a){e.html(a),c.hide()})})};g(),setSpwSortable()});